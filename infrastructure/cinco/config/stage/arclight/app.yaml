template:
  path: ecs-webapp.j2
  type: file
parameters:
  ClusterName: !stack_output stage/cluster.yaml::ECSCluster
  Namespace: cinco-arclight-stage
  VpcId: !environment_variable VPC_ID
  SubnetIDs: !environment_variable SUBNET_IDS
  ContainerImage: !stack_output stage/arclight/build.yaml::ECRRepository
  ContainerPort: 80
  HealthCheckPath: '/'
  DBInstanceSecurityGroup: !stack_output stage/arclight/db.yaml::RDSSecurityGroup
sceptre_user_data:
  ContainerEntryPoint: "/rails/bin/docker-entrypoint"
  ContainerCommand:
    - "./bin/rails"
    - "server"
  Description: "Arclight Web Application running in ECS"
  ContainerEnvironment:
    - RAILS_MASTER_KEY: !environment_variable RAILS_MASTER_KEY
    - S3_BUCKET: !environment_variable S3_BUCKET_NAME
    - POSTGRES_USER: !environment_variable ARCLIGHT_DB_USERNAME
    - POSTGRES_PASSWORD: !environment_variable ARCLIGHT_DB_PASSWORD
    - SOLR_URL: !stack_output stage/solr/reader.yaml::LoadBalancerDNSName
  GrantHttpAccessFromThisServiceTo:
    - !stack_output stage/solr/reader.yaml::LoadBalancerSecurityGroup
