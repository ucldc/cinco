# OAC Arclight - Public front end for OAC

The


## Getting started

You'll need Ruby available, the version specificed in (.ruby-version)[.ruby-version]. You probably want to manage yourt rubies with a tool like rbenv

You'll also need to create a file in the config directory named `master.key` with a shared value that can be provided to you by another developer on the team.

On those dependencies are satified, run the following commands:
```
# install dependenices
bundle

# run db migrations
bundle exec rails db:migrate

# start solr
docker compose up -d

# start the rails server
bundle exec rails s
```

## Indexing

To run the indexer with our customizations use the following command from the arclight root:

```
bundle exec traject -I lib/ -u http://<solr_url>:8983/solr/blacklight-core -i xml -c lib/arclight/traject/ead2_config.rb path/to/file.xml
```
** Settings
Settings can be added to the index command with `-s name=value`

`preview` - if an item is being previewed rather than published set to "true" `-s preview=true` (default: false)
`ark` - set to the ark generated by cincoctrl, this will be the url of the item in arclight `-s ark=xxXXXXXX`

** Environment variables
`REPOSITORY_ID` - Must be set to Repository.code (from cincoctrl) to add to a repository in arclight (no default)
`TEXT_FILE_NAME` - May be set to change the name of the the file that contains extracted text (default: `extracted-supplementary-files-text.txt`)
`TEXT_FILE_DIR` - May be set to change the directory where the text file is located (default: same directory as the XML)

## Running the tests

We test the application with [rspec](https://rspec.info/).

`bundle exec spec` will run all of the rspec tests.

`bundle exec spec spec/components/my_component_spec.rb` will run just the tsts in that file.

## Linting

We run rubocop as part of the pre-commit configuration. By default, it only runs on the diff between the current commit and the previous commit. If you need to to run on the entire codebase, you can run it manually with `bundle exec rubocop -a`
